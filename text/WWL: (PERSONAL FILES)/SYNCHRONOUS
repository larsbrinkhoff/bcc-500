.GL  TRANS-MIT-TING TRANS-MIT-TED THERE-FORE SYNCH-RONIZ-ATION
.GL SUB-TRACT-ED RE-SEND
.GL  WAIT-ING VERI-FIES TRANS-MIT TRANS-MIS-SION SYNCH-RON-IZED
.GL SIMUL-TANEOUS-LY SEC-OND-ARY RE-SYNC RE-PEAT-ING
.GL RE-CEIV-ING RE-CEIV-ER RE-CEIVE PLAC-ING FOL-LOW-ING
.GL DES-CRIBES CON-TIN-UOUS CON-STANT-LY COM-MUNI-CATES
.GL CHAR-ACTER ASYNCH-RON-OUS ASSOC-IATED ANY-WHERE
.GL ACTUAL-LY ACK-NOWLEDG-MENT
.SP 3
.CE
↑USYNCHRONOUS COMMUNICATION PROTOCOL
.SP
.CE
FOR THE
.SP
.CE
BCC 500↑/ELF DATA CONNECTION↑L
.SP 4
1.0 ↑CGENERAL
.SP
       /THE LINE WILL BE OPERATED WITH 8-BIT BYTES.
/ALTHOUGH THE LINE IS SYNCHRONOUS,
IT WILL BE USED BY THE SOFTWARE
AT EITHER END IN A PSEUDO-ASYNCHRONOUS FASHION.
/THAT IS, THE LINE INTERFACES WILL BE OPERATED TO IGNORE SYNC
CHARACTERS (↑CSYNC).
/WHEN NO INFORMATION IS TO BE PASSED OR WHEN THE TRANSMITTING FUNCTION
AT EITHER END OF THE LINE IS LATE IN PRODUCING THE NEXT BYTE FOR
TRANSMISSION, A ↑CSYNC (026/B) WILL BE SENT AUTOMATICALLY BY THE
SENDING INTERFACE.
/THE SAME CHARACTER ON ARRIVAL AT THE RECEIVING INTERFACE WILL NOT
PRODUCE A SERVICE INTERRUPT AND SO WILL BE IGNORED.

       /SINCE ↑CSYNC IS IGNORED, THE
COMBINATION 026/B MAY NOT BE SENT ON THE LINE,
AND THE LINE CANNOT BE USED FOR TRANSMITTING ARBITRARY INFORMATION.
/TO OVERCOME THIS LIMITATION THE PROTOCOL IS HEREBY
ESTABLISHED WHEREBY THE SPECIAL BYTE ↑CDLE (020/B) WILL PRECEDE THE
TRANSMISSION OF AN 066 AND WILL ACT AS AN ESCAPE, SIGNIFYING THAT THE 
066 MUST HAVE 040/B SUBTRACTED FROM IT BEFORE
FURTHER INTERPRETATION.

       /THE DEDICATION OF ↑CDLE FOR THIS PURPOSE MEANS THAT IT, TOO,
CANNOT BE SENT AS INFORMATION ON THE LINE.
/BUT THE SAME CONVENTION MAY BE USED TO SEND THE VALUE 020: THAT IS,
THE COMBINATION 020 060.
/TO SUMMARIZE, ANY 8-BIT BYTE MAY BE SENT ON THE LINE AT THE CONVENIENCE
OF THE SENDER EXCEPT ↑CSYNC AND ↑CDLE.
/OF THESE, ↑CSYNC IS RESERVED FOR TRANSMISSION DURING IDLE TIME
AND ↑CDLE IS USED TO INDICATE THAT THE FOLLOWING BYTE REQUIRES A SUBTRACTION
OF 040/B.
/THE BYTE 026 THUS APPEARS ON THE LINE AS 020 066, AND 020 APPEARS
AS 020 060.
.EJ
2.0  ↑UCHARACTER FRAMING SYNCHRONIZATION↑L
.SP
       /THE LINE IS SHORT AND DOES NOT INVOLVE MODEMS AND TRANSMISSION
FACILITIES.
/THE EXPECTED ERROR RATE WILL THEREFORE BE SMALL.
/IN PARTICULAR, THE LOSS OF CLOCKS OR OTHER UNTOWARD EVENTS WHICH
MIGHT CAUSE LOSS OF CHARACTER SYNC WILL BE MOST INFREQUENT.
/THE ACTION OF LINE SYNCHRONIZATION WILL BE UNDERTAKEN SELDOM -- 
USUALLY ONLY WHEN RESTARTING THE MACHINE AT EITHER END OF THE LINE.

       /THE ACTUAL ACT OF SYNCHRONIZATION IS INITIATED BY PLACING
A RECEIVER IN "SEARCH MODE."
/IN THIS MODE THE RECEIVER CEASES TO FUNCTION AS SUCH, BUT COMPARES
AT EACH NEW BIT TIME THE LAST 8 BITS RECEIVED WITH THE SYNC CHARACTER.
/WHEN AT MOST TWO SUCH CHARACTERS ARE RECEIVED SUCCESSIVELY, CHARACTER
FRAMING IS ESTABLISHED AND THE RECEIVER REVERTS TO NORMAL ACTIVITY.

       /THE ESTABLISHMENT OF SYNC DOES REQUIRE THE COOPERATION OF
THE OTHER END OF THE LINE.
/TO OBTAIN THIS COOPERATION IN TURN REQUIRES A SIGNALLING SCHEME.
/BY CONVENTION, THEN, WHEN EITHER END OF THE LINE IS INITIALIZED OR
OTHERWISE DETERMINES THAT IT HAS LOST CHARACTER SYNC, THE FOLLOWING
PROCEDURE WILL BE EMPLOYED:
.RM 3,3
.SP 3
↑I/REMARKS:  /THAT END OF THE LINE FIRST NOTICING LOSS OF SYNC IS
CALLED ↑ISYNCEE; IT IS ACTUALLY THE INITIATOR OF THE PROCEDURE.
/THE OTHER END OF THE LINE IS, OF COURSE, THE ↑ISYNCER AND MUST
COOPERATE WITH THE SYNCEE IN ORDER TO ESTABLISH SYNC.
/THERE IS A CHANCE THAT BOTH ENDS OF THE LINE WILL SEE LOSS OF
SYNC SIMULTANEOUSLY AND THAT EITHER END WILL THINK ITSELF TO BE
SYNCEE.
/THIS GIVES RISE TO A POSSIBLE RACE CONDITION.
/THE CHANGE OF SUCH A RACE
IS REDUCED BY HAVING EACH END WAIT A DIFFERENT AMOUNT OF
TIME BEFORE INITIATING ACTION.
/THE RACE WILL THUS OCCUR WITH SMALL ODDS AND IN ANY EVENT IS
NON-CRITICAL.
/NOTE THAT IN THE SCHEME BELOW BOTH DIRECTIONS OF TRANSMISSION ARE
ALWAYS SYNCHRONIZED.
.SP 3
↑I/PROCEDURE:
.SP
.RM 3,3
.RM 5
.UN 5
1.  /SYNCEE IMMEDIATELY SUSPENDS /I↑//O OPERATIONS, SETS REQUEST
TO SEND, COUNTS TO 1000, AND SENDS CONTINUOUS SYNCS.
/SYNCEE THEN VERIFIES AT LAST MOMENT THAT SECONDARY RECEIVE IS LOW AND
ISSUES SECONDARY TRANSMIT, WAITING FOR SECONDARY RECEIVE AS A RESPONSE.

.SP
.UN 5
2.  /SYNCER SEES SECONDARY RECEIVE AND SUSPENDS /I↑//O OPERATIONS.
/SYNCER RESYNCS ITS RECEIVER, SENDS REQUEST TO SEND, AND SENDS CONTINUOUS
SYNCS.
/SYNCER THEN RAISES SECONDARY TRANSMIT AND WAITS FOR LOSS OF SECONDARY
RECEIVE.
.SP
.UN 5
3.  /SYNCEE SYNCS ITS RECEIVER, PREPARES TO RECEIVE INFORMATION, AND
LOWERS SECONDARY TRANSMIT.
/IT WAITS FOR LOSS OF SECONDARY RECEIVE.
.SP
.UN 5
4.  /SYNCER PREPARES TO RECEIVE INFORMATION, DROPS SECONDARY TRANSMIT,
AND RESUMES TRANSMISSIONS.
.SP
.UN 5
5.  /SYNCEE RESUMES TRANSMISSIONS.
.EM 8,3
.SP 2
       /IT IS IMPORTANT THAT THE SYNCEE CHECK ITS OWN SECONDARY
RECEIVE IMMEDIATELY BEFORE REQUESTING A RESYNC.
/IF IT FINDS THE LINE HIGH, THEN IT MUST INSTEAD PLAY THE ROLE OF
SYNCER.
.SP 3
.EM 3,3
       /THE REQUEST↑/CLEAR TO SEND SIGNALS WERE DESIGNED FOR SIGNALLING
WITH HALF-DUPLEX MODE SITUATIONS.
/THESE SIGNALS ARE NOT ESPECIALLY USEFUL FOR OUR INTENDED USE OF THE
LINE.
/HOWEVER, THE SIGNALS DO AFFECT THE OPERATION OF THE LINE INTERFACES
AND SO SHOULD BE KEPT PERMANENTLY ON.
/IF IT IS USEFUL INFORMATION AT ANY TIME, HOWEVER, THE LACK OF A CLEAR
TO SEND SIGNAL AT EITHER END OF THE LINE IS CLEAR EVIDENCE OF THE
OTHER END'S BEING NOT ACTIVE.
/THE CONVERSE IS, OF COURSE, NOT NECESSARILY TRUE.
.EJ
3.0  ↑UINITIATING SYNC IN THE 500↑L
.SP
       /THE PROGRAM TO INITIATE AND ESTABLISH SYNC ON THE LINE AT THE
500 END WILL RESIDE IN ↑CCTP CODE IN THE ↑CCHIO.
/THE ↑CCTP IS A CONVENIENT PROCESSOR FOR SUCH CODE BECAUSE IT IS ACTUALLY
A PART OF THE ↑CCHIO AND HAS READY ACCESS TO THE ↑CCHIO DATA STRUCTURES
AND /I↑//O HARDWARE.
/THE ↑CCTP WILL RUN A LITTLE RESIDENT PROGRAM CONTAINING MISCELLANEOUS
TASKS RELATING TO VARIOUS DEVICES CONNECTED TO THE ↑CCHIO.
/THE SYNCHRONIZATION TASK IS ONE OF THESE.

       /SYNCHRONIZATION WILL BE INITIATED BY A USER PROCESS (THE ↑CFTP
PROCESS) UPON INITIATION OR WHENEVER THE PROCESS BELIEVES THE LINE TO
BE OUT OF SYNC.
/THE ↑CFTP PROCESS COMMUNICATES WITH THE SYNCHRONIZATION TASK IN THE
↑CCTP THROUGH A SPECIAL PSEUDO-TERMINAL LINE, I.E., A ↑CCHIO LINE
NOT ASSOCIATED WITH ANY REAL LINE HARDWARE (JUST ENTRIES IN THE
VARIOUS BIT TABLES).
/THE ↑CFTP "ACQUIRES" THIS LINE AND THEN OUTPUTS A COMMAND ON IT.
/THE ↑CCTP TASK PERIODICALLY READS THE LINE AND THUS PICKS UP THE
COMMAND.
/RESPONSES ARE RETURNED THROUGH THE OTHER HALF OF THE LINE.

       /THE EXACT COMMANDS AND THEIR ASSOCIATED RESPONSES AND THEIR
FORMATS WILL BE SPELLED OUT IN A SEPARATE DOCUMENT.

.EJ
4.0  ↑UERROR DETECTION AND RECOVERY PROCEDURES↑L

.SP
       /SPECIFICATION /S-1 GIVES THE BASIC DATA FORMAT ON THE LINE
AND DESCRIBES THE FLOW CONTROL.
/THIS APPROACH WAS DEVELOPED FOR USE WITH THE /D/J-11 ASYNCHRONOUS
LINE INTERFACE WHICH MAY RUN AT RATES UP TO 9600 BPS.
/THE SYNCHRONOUS LINE WILL RUN AT RATES UP TO 38.4 /KBPS BUT MAY BE
MORE SUBJECT TO ERROR, ESPECIALLY IF A CLOCK IS MISSED.
/THIS SECTION DESCRIBES A MODIFICATION (ACTUALLY AN ENHANCEMENT) OF
THE DATA FORMAT↑/FLOW CONTROL OUTLINES IN /S-1.

       /WHEREAS /S-1 MENTIONS FOUR 30-CHARACTER BUFFERS, THE SYNCHRONOUS
LINE WILL UTILIZE A GREATER NUMBER OF BUFFERS, EACH OF WHICH IS LARGER
THAN 30 CHARACTERS.  /THE ACTUAL NUMBERS WILL HAVE TO BE DETERMINED
BY NEGOTIATION WITH ↑CELF EXPERTS, BUT IN ORDER TO MAINTAIN A
TRANSMISSION RATE ANYWHERE NEAR THE 38.4 /KPBS RATE
A TOTAL OF AT LEAST TWO SECOND'S WORTH OF TRANSMISSION MUST BE
BUFFERED.  
/THAT IS, AT 4800 CHARACTERS↑/SEC, ABOUT 10/K BYTES.
/INSTEAD OF A 16-BIT BINARY COUNT OF THE NUMBER OF CHARACTERS IN A
BUFFER-LOAD PRECEDING THE BUFFER ON THE LINE, EACH BUFFER ON THE
SYNCHRONOUS LINE WILL BE PRECEDED BY A 16-BIT HEADER WORD AND
FOLLOWED BY A 16-BIT CYCLIC CHECK SUM.

       /THE HEADER WORD WILL CONSIST OF AN 8-BIT BINARY CHARACTER
COUNT (AS BEFORE EXCEPT NOW THE FIRST OF THE TWO BYTES) AND AN 8-BIT
BINARY BUFFER /I./D. NUMBER.
/DURING TRANSMISSIONS THE NUMBER OF EACH BUFFER WILL BEGIN WITH 128
AND INCREASE UP TO 255 BEFORE REVERTING TO 128 AND REPEATING.

       /THE CHECK SUM WILL BE TRANSMITTED AS TWO 8-BIT BINARY BYTES,
MORE SIGNIFICANT BYTE FIRST.
/THE CHECK SUM WILL BE FORMED AS FOLLOWS:  /EACH NEW CHARACTER PLACED
IN A BUFFER WILL BE /E/O/RED WHILE RIGHT-JUSTIFIED IN A 16-BIT REGISTER
WITH THE PRECEDING VALUE OF THE CHECK SUM.
/THEN THIS NEW VALUE WILL BE LEFT CYCLED 5 PLACES TO FORM THE CURRENT
VALUE OF THE CHECK SUM.
/AFTER THE APPROPRIATE N CHARACTERS THE RESULT IS THE BUFFER CHECKSUM.

       /EACH BUFFER TRANSMITTED WILL REQUIRE A POSITIVE ACKNOWLEDGMENT
AND AN /I./D. CHECK FROM THE RECEIVING END.
/FLOW CONTROL WILL BE IMPLICIT IN THESE ACKNOWLEDGMENTS.

       /AS IN /S-1, THREE 200 (OCTAL) BYTES WILL BE SENT BY THE RECEIVING
END AT THE BEGINNING OF DATA TRANSFER TO INDICATE START OF TRANSMISSION.
/SIMILARLY AT THE END OF TRANSMISSION A SINGLE 203 BYTE WILL BE SENT
AS VERIFICATION THAT THE RECEIVING ↑CDTP HAS TERMINATED.
/IF FOR ANY REASON THE RECEIVING ↑CDTP TERMINATES PREMATURELY, A SINGLE
204 BYTE WILL BE SENT AS NOTIFICATION.
/APPROPRIATE MESSAGES WILL SIMULTANEOUSLY FLOW ON THE CONTROL LINE.
/THE 201 AND 202 BYTES WILL, HOWEVER, EACH BE FOLLOWED BY AN /I./D.
NUMBER AND, WHILE STILL SERVING TO PERFORM FLOW CONTROL, WILL ALSO
ACT AS ACKNOWLEDGMENT MESSAGES.

       201 WILL MEAN POSITIVE ACKNOWLEDGMENT FOR BUFFER N; BUFFER
RECEIVED CORRECTLY AND THERE IS NOW ROOM FOR ANOTHER BUFFER
LOAD.
202 WILL MEAN POSITIVE ACKNOWLEDGMENT FOR BUFFER N KNOWN TO BE THE
LAST BUFFER; ↑CDTP ACTIVITY WILL THEREFORE CEASE WITH THIS BUFFER.
205 WILL BE A NEGATIVE ACKNOWLEDGMENT FOR BUFFER N; BUFFER RECEIVED IN
ERROR; RESEND, AS THERE IS NOW ROOM TO RECEIVE.

       /WHEN A 205 IS RECEIVED, OR WHEN SOME SEQUENCE ERRORS ARE NOTED
THE RECOVERY PROCEDURE WILL WORK AS FOLLOWS.  /THE PROCEDURE IS
DESIGNED FOR SIMPLICITY AND IS BASED ON THE EXPECTED LOW ERROR RATE.
/WE DISCUSS CHECK SUM ERRORS AND SEQUENCE ERRORS SEPARATELY.
/FIRST, CHECK SUM ERRORS.

       /THE SENDING PROCESS WILL RETAIN A COPY OF THE TRANSMITTED BUFFER
LOAD UNTIL THE ACKNOWLEDGMENT HAS BEEN RECEIVED.
/AT THAT TIME IF IT IS NEGATIVE, THE SENDING ↑CDTP WILL REJECT AND
FLUSH FROM ITS BUFFER SPACE ALL BUFFERS RECEIVED AFTER A DEFECTIVE ONE
UNTIL THAT BUFFER REAPPEARS.
/NO ACKNOWLEDGMENTS WILL BE SENT FOR THE REJECTED BUFFERS.